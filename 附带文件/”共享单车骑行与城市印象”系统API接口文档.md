# ”共享单车骑行与城市印象”系统API接口文档

***

##  1. 修订记录：

| 发布日期 |  修改说明  |
| :------: | :--------: |
| 2020-1-2 | 第一次发布 |

## 2. 排版约定

|                           排版格式                           |  含义  |
| :----------------------------------------------------------: | :----: |
| 斜体<font face="Times New Roman">*Times New Roman*</font>英文 |  函数  |
|                             < >                              |  变量  |
|                             { }                              | 数据表 |

## 3. 编码

若请求消息体中的参数支持中文，则中文字符必须为UTF-8编码。

## 4. API规格

### a. 公共请求消息头

下表列出了所有API 所携带的公共头域。HTTP 协议的标准头域不再这里列出了。

| **消息头（Header）** | **是否必须** |            **说明**             |
| :------------------: | :----------: | :-----------------------------: |
|     Content-Type     |     可选     | application/json; charset=utf-8 |

### b. 公共响应消息头

下表列出了所有API的公共响应头域。HTTP协议的标准响应头域不再这里列出了。

| **消息头（Header）** |                    **说明**                     |
| :------------------: | :---------------------------------------------: |
|     Content-Type     | 只支持JSON格式，application/json; charset=utf-8 |

### c. 错误返回格式

```json
{
    "code" : "AccessDenied",
    "message" : "Access denied.",
    "body" : ""
}
```

### d. 公共错误码

| 错误码 |        错误描述        | HTTP状态码 |   中文解释   |       英文解释        |
| :----: | :--------------------: | :--------: | :----------: | :-------------------: |
|  404   | 未找到该请求的路由地址 |    404     | 请求地址错误 |    Page Not Found     |
|  405   |  该请求的方法不被允许  |    405     | 请求方法错误 |  Method Not Allowed   |
|        |  请求未完成，服务异常  |    500     |  服务器出错  | Internal Server Error |

### e. 接口说明

***

#### 接口描述

​	顺序获取64个BikeID

#####  功能介绍

	+ 通过解析客户端request请求的<PageNumber>字段同时结合数据库中{BikeTable}表的ID字段,分页请求数据库中的<BikeID>字段

##### 请求参数

|    参数    | 是否必选 |                             描述                             |
| :--------: | :------: | :----------------------------------------------------------: |
| PageNumber |   Yes    | 获取{BikeTable}中ID为<PageNumber>\*64~<PageNumber>*64+64的<BikeID> |



##### 请求示例

> http://169.254.251.181:5000/bl?PageNumber=1

 ##### 响应示例

```json
{
  "0": "04B6w7",
  "1": "04BA6D",
  "10": "04BMBl",
  "11": "04BMDX",
  "12": "04BMOr",
  ...
}
```

***

#### 接口描述

​	获取对应<BikeID>在{BikeTable}表中的所有记录

##### 功能介绍

+ 通过解析request请求中的<BikeID>字段，查询数据库中与之相应的记录行，并获取并和返回的所有数据。

##### 请求参数

|  参数  | 是否必选 |                     描述                      |
| :----: | :------: | :-------------------------------------------: |
| BikeID |   Yes    | 获取{BikeTable}中BikeID等于<BikeID>的所有记录 |

##### 请求示例

> http://169.254.251.181:5000/?BikeID=0447OP

##### 响应示例

```json
{
	"0":{
      "endTime":"2018-02-05 15:59:26",
      "end_x":"114.2661969",
      "end_y":"30.5723752",
      "startTime":"2018-02-05 15:57:22",
      "start_x":"114.2664457",
      "start_y":"30.57371786",
      "targetBikeID":"0447OP"
     },
 	"1":{
         "endTime":"2018-02-05 16:03:27",
         "end_x":"114.2716095",
         "end_y":"30.56991259",
         "startTime":"2018-02-05 16:01:27",
         "start_x":"114.2661969",
         "start_y":"30.5723752",
         "targetBikeID":"0447OP"
     }
    ...
 }
```

***

#### 接口描述

​	获取每一条路线的Bike与Bus分别的金钱消耗、时间消耗、所需步行路程

##### 功能介绍

+ 通过解析解析request请求中的<BikeID>和<StartTime>字段在{BikeTable}表中定位一条骑行记录，同时通过相应的ID获取在{GameAnalysisTable}中相应的记录。
+ 分别返回记录中的金钱消耗、时间消耗、所需步行路程。

##### 请求参数

|   参数    | 是否必选 |         描述         |
| :-------: | :------: | :------------------: |
|  BikeID   |   Yes    | 骑行记录中自行车的ID |
| StartTime |   Yes    | 骑行记录中的开始时间 |

##### 请求示例

>http://169.254.251.181:5000/gcbbi?BikeID=0447OP&StartTime=2018-02-05%2015:57:22

##### 响应示例

```json
{
	"bike":{
        "Cost":"1.0",
        "Distance":"202",
        "Duration":"124"
    },
    "bus":{
        "Cost":"0.0",
        "Distance":"0",
        "Duration":"0"
    }
}
```

***

#### 接口描述

​	获取对应日期分别24小时的骑行量

##### 功能描述

+ 通过解析解析request请求中的<Date>字段，获取{CyclingAmount}表中的一行记录。
+ 该记录包含该天24小时的时间段在骑行的数量

##### 请求参数

| 参数 | 是否必选 |             描述             |
| :--: | :------: | :--------------------------: |
| Date |   Yes    | 表示某一天，格式为：YY-MM-DD |

##### 请求示例

> http://169.254.251.181:5000/amount?Date=2018-02-05

##### 响应示例

```json
{
    "0":"2734",
    "1":"1547",
    "10":"1990",
    "11":"3700",
    "12":"13779",
    "13":"11879",
    "14":"33335",
    "15":"38492",
    "16":"33603",
    "17":"34308",
    "18":"35567",
    "19":"27908",
    "2":"1259",
    "20":"19978",
    "21":"19473",
    "22":"20311",
    "23":"17114",
    "3":"1009",
    "4":"853",
    "5":"773",
    "6":"958",
    "7":"1793",
    "8":"2802",
    "9":"2019"
}
```

***

#### 接口描述

​	获取骑行时间分布图

##### 功能描述

+ 客户端向服务器发送请求，服务器端发送给客户端关于骑行时间的分布数据
+ 分布数据分成3部分，第一部分为骑行时间0\~100s，第二部分数据为骑行时间100\~200s，第三部分数据为200\~90200，分别划分间隔为：10s，5s，5000s

##### 请求参数

​	无

##### 请求示例

> http://169.254.251.181:5000/ct

##### 响应示例

```json
{
    "10":{
        "0":"44",
        "1":"53",
        "2":"13",
        "3":"1",
        "4":"12",
        "5":"60",
        "6":"19",
        "7":"63",
        "8":"19",
        "9":"24"
    },
    "5":{
        "0":"33",
        "1":"69",
        "10":"1925",
        "11":"1371",
        "12":"876",
        "13":"892",
        "14":"281",
        "15":"116",
        "16":"16",
        "17":"86",
        "18":"487",
        "19":"53",
        "2":"255",
        "3":"11369",
        "4":"45544",
        "5":"51666",
        "6":"18405",
        "7":"8539",
        "8":"6876",
        "9":"3287"
    },
    "5000":{
        "0":"9662",
        "1":"195",
        "10":"15",
        "11":"6",
        "12":"9",
        "13":"3",
        "14":"0",
        "15":"3",
        "16":"5",
        "17":"180",
        "2":"149",
        "3":"100",
        "4":"95",
        "5":"75",
        "6":"55",
        "7":"51",
        "8":"506",
        "9":"29"
    }
}
```

***

#### 接口描述

​	获取骑行距离分布图

##### 功能描述

+ 客户端向服务器发送请求，服务器端发送给客户端关于骑行距离的分布数据
+ 骑行距离数据的分布间隔为1750m

##### 请求参数

​	无

##### 请求示例

> http://169.254.251.181:5000/cd

##### 响应示例

```json
{
    "0":"97848",
    "1":"48604",
    "10":"44",
    "11":"14",
    "12":"14",
    "13":"17",
    "14":"66",
    "15":"13",
    "16":"17",
    "17":"3",
    "18":"7",
    "19":"1",
    "2":"9740",
    "3":"2677",
    "4":"1585",
    "5":"1622",
    "6":"627",
    "7":"385",
    "8":"231",
    "9":"77"
}
```

***

#### 接口描述

​	返回绘制好的包含热力图和流向图的HTML页面

##### 功能描述

+ 客户端向服务器请求数据，服务器返回客户端一个绘制了所有数据的热力图和流向图的HTML界面

##### 请求参数

​	无

##### 请求示例

> http://169.254.251.181:5000/chp

##### 响应示例

![](https://s2.ax1x.com/2020/01/02/lN3axs.png)

<center>热力图</center>

![](https://s2.ax1x.com/2020/01/02/lN3hs1.png)

<center>骑行流向图</center>

***

#### 接口描述

​	获取骑行终点以及骑行起点在光谷火车站100米范围内的骑行信息

##### 功能描述

+ 客户端向服务器请求数据，服务器端返回骑行终点以及骑行起点在光谷火车站100米范围内的骑行信息。
+ 骑行信息包括骑行时间和骑行距离。

##### 请求参数

​	无

##### 请求示例

> http://169.254.251.181:5000/mca

##### 响应示例

```json
{
	"arrived":{
		"0":{"distance":"787","time":"142"},
		"1":{"distance":"801","time":"119"},
		"10":{"distance":"660","time":"141"},
		"11":{"distance":"660","time":"122"},
		"12":{"distance":"2391","time":"126"}
        ...
},
	"left":{
			"0":{"distance":"2252","time":"122"},
			"1":{"distance":"1860","time":"121"},
			"10":{"distance":"2262","time":"126"},
			"11":{"distance":"2262","time":"123"}
        ...
	}
}
```

***

#### 接口描述

​	获取骑行终点以及骑行起点在相应的<State>100m范围内的骑行信息

##### 功能描述

+ 服务器端解析客户端request的<State>字段
+ 服务器获取相应的骑行的数据并返回给客户端

##### 请求参数

| 参数  | 是否必选 |               描述               |
| :---: | :------: | :------------------------------: |
| State |   Yes    | 服务器返回与该车站相关的骑行数据 |

##### 请求示例

> http://169.254.251.181:5000/getData?State=JieDaoKou

##### 响应示例

```json
{
	"arrived":{
		"0":{
		"distance":"1617",
		"time":"122"
		},
		"1":{
		"distance":"1617",
		"time":"125"
		}
        ...
	},
	"left":{
		"0":{
		"distance":"3251",
		"time":"127"
		},
		"1":{
		"distance":"3251",
		"time":"129"
		}
        ...
	}
}
```

***

#### 接口描述

​	返回绘制好的流向图的HTML页面

##### 功能描述

+ 服务器端解析客户端request的<State>字段
+ 服务器返回与相应的火车站的绘制好的骑行HTML页面客户端

##### 请求参数

| 参数  | 是否必选 |               描述               |
| :---: | :------: | :------------------------------: |
| State |   Yes    | 服务器返回与该车站相关的HTML页面 |

##### 请求示例

> https://s2.ax1x.com/2020/01/02/lN0FE9.png

##### 响应示例

![](https://s2.ax1x.com/2020/01/02/lN0FE9.png)

***

